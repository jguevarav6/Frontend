<aside
  [class.collapsed]="collapsed"
  class="sidebar-container">

  <!-- Header: logo + nombre -->
  <div class="sidebar-header">
    <!-- Collapse toggle -->
    <button 
      aria-label="Toggle sidebar" 
      class="sidebar-toggle" 
      (click)="toggle()"
      [class.rotate]="!collapsed">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 12h18M3 6h18M3 18h18" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <!-- Logo siempre visible -->
    <div class="logo-container">
      <div class="logo-wrapper">
        <img
          src="assets/logo.png"
          alt="BM Logo"
          class="logo-img"
          decoding="async"
          fetchpriority="high"
          (error)="onLogoError($event)"
        />
        <!-- Fallback si falla la imagen -->
        <div class="logo-text" *ngIf="logoLoadError">BM</div>
      </div>

      <!-- Nombre de la empresa (solo cuando NO está colapsado) -->
      <div class="company-info" *ngIf="!collapsed">
        <h1 class="company-name">
          BELTRÁN MARTÍNEZ<br/>&amp; ASOCIADOS
        </h1>
        <p class="company-subtitle">Asesoría fiscal y contable</p>
      </div>
    </div>
  </div>

  <!-- Navegación -->
  <nav class="sidebar-nav" *ngIf="!collapsed">
    <a
      routerLink="/items"
      routerLinkActive="active"
      [routerLinkActiveOptions]="{exact: true}"
      class="nav-item"
    >
      <div class="nav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7" rx="1.5"/>
          <rect x="14" y="3" width="7" height="7" rx="1.5"/>
          <rect x="14" y="14" width="7" height="7" rx="1.5"/>
          <rect x="3" y="14" width="7" height="7" rx="1.5"/>
        </svg>
      </div>
      <span class="nav-text">Panel Principal</span>
      <div class="nav-indicator"></div>
    </a>

    <a
      routerLink="/items/declaracion"
      routerLinkActive="active"
      class="nav-item"
    >
      <div class="nav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="12" y1="18" x2="12" y2="12"/>
          <line x1="9" y1="15" x2="15" y2="15"/>
        </svg>
      </div>
      <span class="nav-text">Declaraciones</span>
      <div class="nav-indicator"></div>
    </a>

    <a
      routerLink="/items/justificacion"
      routerLinkActive="active"
      class="nav-item"
    >
      <div class="nav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
          <polyline points="10 9 9 9 8 9"/>
        </svg>
      </div>
      <span class="nav-text">Justificación</span>
      <div class="nav-indicator"></div>
    </a>

    <a
      (click)="onComingSoon('Pagos')"
      class="nav-item"
      style="cursor: pointer;"
    >
      <div class="nav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="7" width="20" height="14" rx="2"/>
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
        </svg>
      </div>
      <span class="nav-text">Pagos</span>
      <div class="nav-indicator"></div>
    </a>

    <a
      (click)="onComingSoon('Mis Documentos')"
      class="nav-item"
      style="cursor: pointer;"
    >
      <div class="nav-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
        </svg>
      </div>
      <span class="nav-text">Mis Documentos</span>
      <div class="nav-indicator"></div>
    </a>

    <!-- Divider -->
    <div class="nav-divider"></div>
  </nav>

  <!-- User Info & Logout -->
  <div class="user-section" *ngIf="!collapsed">
    <div class="user-info">
      <div class="user-avatar">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
      </div>
      <div class="user-details">
        <p class="user-name">{{ currentUser?.name || 'Usuario' }}</p>
        <p class="user-role">{{ currentUser?.role === 'admin' ? 'Administrador' : 'Usuario' }}</p>
      </div>
    </div>
    <button class="logout-button" (click)="onLogout()" title="Cerrar sesión">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
        <polyline points="16 17 21 12 16 7"/>
        <line x1="21" y1="12" x2="9" y2="12"/>
      </svg>
      <span>Salir</span>
    </button>
  </div>

  <!-- TaxHelp Card -->
  <div class="taxhelp-card" *ngIf="!collapsed">
    <div class="taxhelp-icon">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
        <line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
    </div>
    <h3 class="taxhelp-title">¿Necesitas ayuda?</h3>
    <p class="taxhelp-text">Estamos aquí para guiarte en cada paso</p>
    <a
      href="https://bmasociados.co/"
      target="_blank"
      rel="noopener noreferrer"
      class="taxhelp-button"
    >
      <span>Contáctanos</span>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M5 12h14M12 5l7 7-7 7"/>
      </svg>
    </a>
  </div>

</aside>

<!-- Overlay for mobile -->
<div class="sidebar-overlay" *ngIf="!collapsed" (click)="toggle()"></div>
